<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive API Testing Workflow: Generated by AI</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Fira+Code:wght@400;500&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc; /* slate-50 */
        }
        pre code.hljs {
            display: block;
            overflow-x: auto;
            padding: 1em;
            font-family: 'Fira Code', monospace;
        }
        .step-link.active {
            background-color: #e0f2fe; /* sky-100 */
            color: #0c4a6e; /* sky-900 */
            font-weight: 600;
        }
        .step-link.completed {
            color: #15803d; /* green-700 */
        }
        .step-link.completed .step-circle {
            background-color: #22c55e; /* green-500 */
            border-color: #166534; /* green-800 */
        }
        .step-link.completed .step-circle svg {
            display: block;
        }
        .step-link .step-circle svg {
            display: none;
        }
    </style>
</head>
<body class="antialiased text-slate-700">

    <div id="app" class="flex flex-col md:flex-row min-h-screen">
        <!-- Sidebar Navigation -->
        <aside class="w-full md:w-1/4 lg:w-1/5 bg-white border-r border-slate-200 p-4 md:p-6">
            <h1 class="text-xl font-bold text-slate-800">API Test Workflow</h1>
            <h2 class="text-sm mb-4">Generated by AI</h2>
            <nav id="step-navigation" class="space-y-2">
                <!-- Step links will be dynamically inserted here -->
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="flex-1 p-4 md:p-8 lg:p-10">
            <div id="step-content">
                <!-- Step content will be dynamically inserted here -->
            </div>
        </main>
    </div>

    <script>
        const App = {
            // Application state to hold tokens, IDs, etc.
            state: {
                currentStep: 0,
                tokens: {
                    owner1: null,
                    owner2: null,
                    customer1: null,
                    delivery1: null,
                    delivery2: null,
                },
                orderId: null,
                assignmentId: null,
            },

            // All the data for the testing workflow, from the report
            workflowData: [
                {
                    title: "Log in as Restaurant Owner 1",
                    description: "Get the authentication token for the owner of Restaurants 1 & 2.",
                    endpoint: "POST /api/v1/auth/login",
                    requiresAuth: false,
                    payload: { email: "owner1@example.com", password: "password" },
                    run: (app) => {
                        const token = `owner1_token_${Date.now()}`;
                        app.state.tokens.owner1 = token;
                        return { success: true, message: "Login successful.", data: { access_token: token } };
                    }
                },
                {
                    title: "Create Radius Zone for Restaurant 1",
                    description: "Using Owner 1's token, create a radius delivery zone for Restaurant 1.",
                    endpoint: "POST /api/v1/restaurants/1/zones",
                    requiresAuth: 'owner1',
                    payload: { name: "R1 - 3km Radius", type: "radius", value: 3000 },
                     run: (app) => ({ success: true, message: "Radius zone created successfully." })
                },
                 {
                    title: "Create Polygon Zone for Restaurant 1",
                    description: "Using Owner 1's token, create a polygon delivery zone for Restaurant 1.",
                    endpoint: "POST /api/v1/restaurants/1/zones",
                    requiresAuth: 'owner1',
                    payload: { name: "R1 - Gulshan Area", type: "polygon", value: [ { "lat": 23.78, "lng": 90.40 }, { "lat": 23.80, "lng": 90.40 }, { "lat": 23.80, "lng": 90.42 }, { "lat": 23.78, "lng": 90.42 } ] },
                    run: (app) => ({ success: true, message: "Polygon zone created successfully." })
                },
                {
                    title: "Log in as Restaurant Owner 2",
                    description: "Get the token for the owner of Restaurants 3 & 4.",
                    endpoint: "POST /api/v1/auth/login",
                    requiresAuth: false,
                    payload: { email: "owner2@example.com", password: "password" },
                    run: (app) => {
                        const token = `owner2_token_${Date.now()}`;
                        app.state.tokens.owner2 = token;
                        return { success: true, message: "Login successful.", data: { access_token: token } };
                    }
                },
                {
                    title: "Create Zones for Restaurant 2",
                    description: "Using Owner 2's token, create two zones for Restaurant 2.",
                    endpoint: "POST /api/v1/restaurants/2/zones",
                    requiresAuth: 'owner2',
                    payload: { name: "R2 - 4km Radius", type: "radius", value: 4000 },
                    run: (app) => ({ success: true, message: "Radius zone for R2 created." })
                },
                {
                    title: "Log in & Update Delivery Person 1",
                    description: "Log in and set this person as available inside Restaurant 1's zone.",
                    endpoint: "PUT /api/v1/delivery-person/status",
                    requiresAuth: 'delivery1',
                    loginPayload: { email: "delivery1@example.com", password: "password" },
                    payload: { is_available: true, current_latitude: 23.7925, current_longitude: 90.4125 },
                     run: (app) => {
                        if (!app.state.tokens.delivery1) {
                            const token = `delivery1_token_${Date.now()}`;
                            app.state.tokens.delivery1 = token;
                            return { success: true, message: "Logged in. Now click 'Run Step' again to update status.", requiresReRun: true, data: { access_token: token } };
                        }
                        return { success: true, message: "Status updated successfully." };
                    }
                },
                {
                    title: "Log in & Update Delivery Person 2",
                    description: "Log in and set this person as available, but outside Restaurant 1's zone.",
                    endpoint: "PUT /api/v1/delivery-person/status",
                    requiresAuth: 'delivery2',
                    loginPayload: { email: "delivery2@example.com", password: "password" },
                    payload: { is_available: true, current_latitude: 23.8759, current_longitude: 90.3979 },
                    run: (app) => {
                         if (!app.state.tokens.delivery2) {
                            const token = `delivery2_token_${Date.now()}`;
                            app.state.tokens.delivery2 = token;
                            return { success: true, message: "Logged in. Now click 'Run Step' again to update status.", requiresReRun: true, data: { access_token: token } };
                        }
                        return { success: true, message: "Status updated successfully." };
                    }
                },
                {
                    title: "Log in as Customer",
                    description: "Get the customer's authentication token.",
                    endpoint: "POST /api/v1/auth/login",
                    requiresAuth: false,
                    payload: { email: "customer1@example.com", password: "password" },
                    run: (app) => {
                        const token = `customer1_token_${Date.now()}`;
                        app.state.tokens.customer1 = token;
                        return { success: true, message: "Login successful.", data: { access_token: token } };
                    }
                },
                {
                    title: "Place Order 1 (Success Case)",
                    description: "Place an order for Restaurant 1 with a delivery location inside its zone.",
                    endpoint: "POST /api/v1/orders",
                    requiresAuth: 'customer1',
                    payload: { restaurant_id: 1, delivery_address: "House 10, Road 5, Gulshan, Dhaka", delivery_latitude: 23.7930, delivery_longitude: 90.4135, total_amount: 1500.00 },
                    run: (app) => {
                        const orderId = Math.floor(1000 + Math.random() * 9000);
                        app.state.orderId = orderId;
                        return { success: true, message: "Order placed successfully.", data: { id: orderId, status: "pending" } };
                    }
                },
                {
                    title: "Place Order 2 (Failure Case)",
                    description: "Place an order for Restaurant 2 with a location outside its defined zones.",
                    endpoint: "POST /api/v1/orders",
                    requiresAuth: 'customer1',
                    payload: { restaurant_id: 2, delivery_address: "Far away, Savar", delivery_latitude: 23.8563, delivery_longitude: 90.2579, total_amount: 800.00 },
                    run: (app) => ({ success: false, message: "This location is outside our delivery area.", statusCode: 422 })
                },
                {
                    title: "Assign Order 1",
                    description: "Trigger the assignment for the successful order. The system should find Delivery Person 1.",
                    getEndpoint: (app) => `POST /api/v1/orders/${app.state.orderId}/assign`,
                    requiresAuth: 'owner1',
                    payload: {},
                    run: (app) => {
                        if (!app.state.orderId) return { success: false, message: "Cannot run: Place Order 1 first to get an Order ID." };
                        const assignmentId = Math.floor(100 + Math.random() * 900);
                        app.state.assignmentId = assignmentId;
                        return { success: true, message: "Order has been assigned.", data: { id: assignmentId, order_id: app.state.orderId, status: "pending" } };
                    }
                },
                {
                    title: "Accept the Assignment",
                    description: "Log back in as Delivery Person 1 and accept the assignment.",
                    getEndpoint: (app) => `POST /api/v1/assignments/${app.state.assignmentId}/accept`,
                    requiresAuth: 'delivery1',
                    payload: {},
                     run: (app) => {
                         if (!app.state.assignmentId) return { success: false, message: "Cannot run: Assign Order 1 first to get an Assignment ID." };
                        return { success: true, message: "Assignment accepted successfully." };
                    }
                },
                {
                    title: "Track the Delivery",
                    description: "Log in as the Customer or Restaurant Owner to track the delivery.",
                    getEndpoint: (app) => `GET /api/v1/orders/${app.state.orderId}/delivery-status`,
                    requiresAuth: 'customer1', // Can also be owner1
                    payload: null,
                     run: (app) => {
                        if (!app.state.orderId) return { success: false, message: "Cannot run: Place Order 1 first to get an Order ID." };
                        return { success: true, message: "Delivery person location retrieved.", data: { current_latitude: 23.7925, current_longitude: 90.4125 } };
                    }
                }
            ],

            // Initialization method
            init() {
                this.renderNavigation();
                this.renderStepContent(this.state.currentStep);
                hljs.highlightAll();
            },

            // Render the left-side navigation
            renderNavigation() {
                const navContainer = document.getElementById('step-navigation');
                navContainer.innerHTML = this.workflowData.map((step, index) => `
                    <a href="#" class="step-link flex items-center p-2 rounded-md transition-colors duration-200 hover:bg-slate-100 ${index === this.state.currentStep ? 'active' : ''}" data-step-index="${index}">
                        <span class="step-circle flex-shrink-0 w-6 h-6 rounded-full border-2 border-slate-300 flex items-center justify-center mr-3">
                           <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" /></svg>
                        </span>
                        <span class="text-sm">${index + 1}. ${step.title}</span>
                    </a>
                `).join('');

                navContainer.addEventListener('click', (e) => {
                    const link = e.target.closest('.step-link');
                    if (link) {
                        e.preventDefault();
                        const index = parseInt(link.dataset.stepIndex);
                        this.state.currentStep = index;
                        this.renderNavigation();
                        this.renderStepContent(index);
                    }
                });
            },

            // Render the main content for the current step
            renderStepContent(index) {
                const step = this.workflowData[index];
                const contentContainer = document.getElementById('step-content');
                
                const endpoint = step.getEndpoint ? step.getEndpoint(this) : step.endpoint;
                const [method, path] = endpoint.split(' ');
                
                let authInfo = 'This request does not require authentication.';
                if (step.requiresAuth) {
                    const token = this.state.tokens[step.requiresAuth];
                    authInfo = token 
                        ? `This request will use the token for <strong>${step.requiresAuth}</strong>.<br><span class="text-xs text-green-700 break-all">TOKEN: ${token}</span>` 
                        : `This request requires a token for <strong>${step.requiresAuth}</strong>. Run the relevant login step first.`;
                }

                contentContainer.innerHTML = `
                    <div class="bg-white p-6 rounded-lg shadow-sm border border-slate-200">
                        <div class="mb-6">
                            <span class="text-sm font-semibold text-sky-600 bg-sky-100 py-1 px-2 rounded-full">STEP ${index + 1} / ${this.workflowData.length}</span>
                            <h2 class="text-2xl font-bold text-slate-800 mt-2">${step.title}</h2>
                            <p class="mt-1 text-slate-600">${step.description}</p>
                        </div>

                        <div class="space-y-6">
                            <div>
                                <h3 class="font-semibold text-slate-700 mb-2">Endpoint</h3>
                                <div class="flex items-center bg-slate-100 p-3 rounded-md">
                                    <span class="font-bold text-sm px-2 py-1 rounded-md ${method === 'POST' ? 'bg-sky-200 text-sky-800' : (method === 'PUT' ? 'bg-amber-200 text-amber-800' : 'bg-emerald-200 text-emerald-800')}">${method}</span>
                                    <span class="font-mono text-sm text-slate-900 ml-4">${path}</span>
                                </div>
                            </div>
                            
                            <div>
                               <h3 class="font-semibold text-slate-700 mb-2">Authentication</h3>
                               <div class="text-sm p-3 bg-slate-50 rounded-md border border-slate-200">${authInfo}</div>
                            </div>

                            ${step.payload ? `
                            <div>
                                <h3 class="font-semibold text-slate-700 mb-2">Request Payload</h3>
                                <pre><code class="language-json hljs rounded-md">${JSON.stringify(step.payload, null, 2)}</code></pre>
                            </div>` : ''}

                            <div class="text-center">
                                <button id="run-step-btn" class="bg-sky-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-sky-700 transition-colors duration-300 disabled:bg-slate-300">
                                    Run Step
                                </button>
                            </div>

                            <div id="response-container" class="hidden">
                                <h3 class="font-semibold text-slate-700 mb-2">Simulated Response</h3>
                                <div id="response-content"></div>
                            </div>
                        </div>
                    </div>
                `;

                const runBtn = document.getElementById('run-step-btn');
                if (step.requiresAuth && !this.state.tokens[step.requiresAuth]) {
                    if (!step.loginPayload) {
                         runBtn.disabled = true;
                    }
                }
                
                runBtn.addEventListener('click', () => this.runStep(index));
                hljs.highlightAll();
            },
            
            // Simulate running a step
            runStep(index) {
                const step = this.workflowData[index];
                
                // Special check for multi-stage steps like login+update
                if (step.requiresAuth && !this.state.tokens[step.requiresAuth] && step.loginPayload) {
                     const loginResult = step.run(this);
                     this.renderResponse(loginResult);
                     this.renderNavigation(); // Re-render to show new token status
                     this.renderStepContent(index); // Re-render to enable button
                     return;
                }
                
                const result = step.run(this);
                this.renderResponse(result);

                if (result.success && !result.requiresReRun) {
                    const navLink = document.querySelector(`.step-link[data-step-index="${index}"]`);
                    navLink.classList.add('completed');
                    
                    // Automatically move to the next step
                    if (index < this.workflowData.length - 1) {
                        setTimeout(() => {
                           this.state.currentStep = index + 1;
                           this.renderNavigation();
                           this.renderStepContent(index + 1);
                        }, 1200);
                    }
                }
            },
            
            // Render the simulated API response
            renderResponse(result) {
                const responseContainer = document.getElementById('response-container');
                const responseContent = document.getElementById('response-content');
                responseContainer.classList.remove('hidden');

                const bgColor = result.success ? 'bg-emerald-50 border-emerald-200' : 'bg-red-50 border-red-200';
                const textColor = result.success ? 'text-emerald-800' : 'text-red-800';

                let dataHtml = '';
                if (result.data) {
                    dataHtml = `<h4 class="font-semibold mt-4 mb-2">Data:</h4><pre><code class="language-json hljs rounded-md">${JSON.stringify(result.data, null, 2)}</code></pre>`;
                }
                
                responseContent.innerHTML = `
                    <div class="p-4 rounded-md border ${bgColor}">
                        <p class="font-semibold ${textColor}">${result.success ? 'Success' : 'Failure'} ${result.statusCode ? `(${result.statusCode})` : ''}</p>
                        <p class="${textColor}">${result.message}</p>
                        ${dataHtml}
                    </div>
                `;
                hljs.highlightAll();
            }
        };

        document.addEventListener('DOMContentLoaded', () => App.init());
    </script>
</body>
</html>
